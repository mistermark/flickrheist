!function(e){e.fn.flickrHeist=function(t){"use strict";var o=e.extend({},e.fn.flickrHeist.defaults,t),a={REST_URL:"http://www.flickr.com/services/rest/",SEARCH:"flickr.photos.search",GETINFO:"flickr.photos.getInfo",APIKEY:o.apikey,FORMAT:"json"};a.PARAMS={SEARCH:{api_key:a.APIKEY,method:a.SEARCH,format:a.FORMAT,tags:o.tags,safe_search:o.safe_search,pages:"1",per_page:o.number_photos,nojsoncallback:"1",sort:o.sortby,extras:o.size+",geo,owner_name",has_geo:"1",min_upload_date:o.min_date},GETINFO:{api_key:a.APIKEY,photo_id:null,format:a.FORMAT}};var l={status:null,target:this,today:(new Date).setHours(0,0,0,0),jsonmodel:{creation_date:null,real_total:null,items:[]},photoSearchUrl:a.REST_URL+"?"+e.param(a.PARAMS.SEARCH)};l.jsonmodel.creation_date=l.today;var i=function(){l.status="initialized",u()},s=function(e){return localStorage&&localStorage.getItem("flickrHeist")?!0:e},r=function(){return window.location.search.indexOf("flickrheist=debug")&&o.debug++,o.debug===!0&&o.debug++,o.debug},n=function(){return JSON.parse(localStorage.getItem("flickrHeist"))},c=function(e){(s(e)!==!0||e.creation_date!==l.today)&&localStorage.setItem("flickrHeist",JSON.stringify(e))},d=function(e){return Math.floor(Math.random()*e.real_total)},u=function(){s(l.jsonmodel)===!0&&r()<=0?f(n()):e.ajax({url:l.photoSearchUrl,dataType:"json",data:JSON,error:function(e,t){throw new Error(t)},success:function(t){l.jsonmodel.real_total=0,e.each(t.photos.photo,function(e,t){void 0!==t[o.size]&&(l.jsonmodel.real_total++,l.jsonmodel.items.push({id:t.id,details:{src:t[o.size],title:t.title,ownername:"",place_id:t.place_id,geo:{city:"",country:""},page_url:""}}))}),c(l.jsonmodel)},complete:function(){f(l.jsonmodel)}})},f=function(e){var t=Handlebars.compile(o.phototemplate);l.target.html(t(e.items[d(e)])),m()},m=function(){e.isFunction(o.complete)&&o.complete.call()};return i()},e.fn.flickrHeist.defaults={apikey:null,tags:"zeitgeist",refresh:24,safe_search:"0",number_photos:"31",sortby:"interestingness-desc",random:!0,size:"url_c",min_date:"1330560000",debug:!0,phototemplate:'<div class="cover-image" style="background-image: url({{details.src}})">',creditstemplate:'<div class="cover-details"><ul class="clearfix"><li class="cover-owner">{{details.title}}</li><li class="cover-location">{{details.place_id}}</li></ul></div>',complete:null}}(jQuery);